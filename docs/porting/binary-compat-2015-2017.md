---
title: 2015 と 2019 間の C++ のバイナリの互換性
description: Visual Studio 2015、2017、および2019でのコンパイル済み C++ ファイル間のバイナリ互換性のしくみについて説明します。 1つの Microsoft Visual C++ 再頒布可能パッケージは、3つのバージョンすべてで動作します。
ms.date: 02/17/2021
helpviewer_keywords:
- binary compatibility, Visual C++
ms.openlocfilehash: a91e339e70843087adc12238edac91332c1a4453
ms.sourcegitcommit: c0c9cdae79f19655e809a4979227c51bb19cff63
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/05/2021
ms.locfileid: "102236577"
---
# <a name="c-binary-compatibility-between-visual-studio-2015-2017-and-2019"></a>Visual Studio 2015、2017、および2019間の C++ バイナリの互換性

Visual Studio 2013 以前の Microsoft C++ (MSVC) コンパイラツールセットでは、メジャーバージョン間のバイナリの互換性は保証されません。 これらのツールセットの異なるバージョンによって構築されたオブジェクトファイル、スタティックライブラリ、ダイナミックライブラリ、および実行可能ファイルをリンクすることはできません。 ABIs、オブジェクト形式、およびランタイムライブラリには互換性がありません。

この動作は、Visual Studio 2015、2017、および2019で変更されています。 これらのいずれかのバージョンのコンパイラによってコンパイルされたランタイムライブラリとアプリは、バイナリと互換性があります。 これは、3つのバージョンすべてで14から始まる C++ ツールセットのメジャー番号に反映されます。 (ツールセットのバージョンは、Visual Studio 2015 の場合は v140、2017の場合は v141、2019の場合は v142) です。 たとえば、Visual Studio 2015 によってビルドされたサードパーティ製のライブラリがあるとします。 Visual Studio 2017 または2019でビルドされたアプリケーションで引き続き使用できます。 一致するツールセットを使用して再コンパイルする必要はありません。 Microsoft Visual C++ 再頒布可能パッケージ (再頒布可能パッケージ) の最新バージョンは、すべてのバージョンで動作します。

## <a name="restrictions-on-binary-compatibility"></a><a name="restrictions"></a> バイナリ互換性に関する制限事項

V140、v141、v142 の各ツールセットとマイナー番号付きバージョンの更新の間のバイナリの互換性には、次の3つの重要な制限があります。

- 異なるバージョンの v140、v141、v142 ツールセットによってビルドされたバイナリを混在させることができます。 ただし、少なくともアプリの最新のバイナリと同じツールセットを使用してリンクする必要があります。 次に例を示します。2017ツールセット (v141、バージョン 15.0 ~ 15.9) を使用してコンパイルされたアプリを、バージョン16.2 またはそれ以降のツールセットを使用してリンクされている場合は、Visual Studio 2019 version 16.2 (v142) を使用してコンパイルされたスタティックライブラリにリンクできます。 16.4 以降のツールセットを使用している限り、バージョン16.2 ライブラリをバージョン16.4 アプリにリンクすることができます。

- アプリが使用する再頒布可能パッケージには、同様のバイナリ互換性制限があります。 サポートされているさまざまなバージョンのツールセットでビルドされたバイナリを混合する場合、再頒布可能バージョンは、すべてのアプリコンポーネントで使用される最新のツールセットと同じである必要があります。

- [ `/GL` (プログラム全体の最適化)](../build/reference/gl-whole-program-optimization.md)コンパイラスイッチまたはリンク [ `/LTCG` (リンク時のコード生成)](../build/reference/ltcg-link-time-code-generation.md)を使用してコンパイルされたスタティックライブラリまたはオブジェクトファイルは、マイナーバージョンの更新を含め、複数のバージョン間ではバイナリ互換性があり *ません*。 およびを使用してコンパイルされたすべてのオブジェクトファイルとライブラリは、 **`/GL`** **`/LTCG`** コンパイルと最終的なリンクにまったく同じツールセットを使用する必要があります。 たとえば、Visual Studio 2019 バージョン16.7 ツールセットのを使用してビルドされたコードは、 **`/GL`** **`/GL`** visual studio 2019 バージョン16.8 ツールセットのを使用してビルドされたコードにリンクすることはできません。 コンパイラは、 [致命的なエラー C1047](../error-messages/compiler-errors-1/fatal-error-c1047.md)を生成します。

## <a name="upgrade-the-microsoft-visual-c-redistributable-from-visual-studio-2015-or-2017-to-visual-studio-2019"></a>Microsoft Visual C++ 再頒布可能パッケージを Visual Studio 2015 または2017から Visual Studio 2019 にアップグレードする

Microsoft Visual C++ 再頒布可能メジャーバージョン番号は、Visual Studio 2015、2017、および2019で同じです。 つまり、再頒布可能パッケージのインスタンスは一度に1つしかインストールできません。 新しいバージョンは、既にインストールされている古いバージョンを上書きします。 たとえば、1つのアプリで Visual Studio 2015 から再頒布可能パッケージをインストールできます。 次に、別のアプリが Visual Studio 2019 から再頒布可能パッケージをインストールします。 2019バージョンでは古いバージョンが上書きされますが、バイナリに互換性があるため、以前のアプリは正常に動作します。 最新バージョンの再頒布可能パッケージには、最新の機能、セキュリティ更新プログラム、およびバグ修正がすべて含まれていることを確認します。 そのため、常に使用可能な最新バージョンにアップグレードすることをお勧めします。

同様に、新しいバージョンが既にインストールされている場合は、古い再頒布可能パッケージをインストールすることはできません。 実行しようとすると、インストーラーによってエラーが報告されます。 既に2019バージョンを搭載しているコンピューターに2015または2017再頒布可能パッケージをインストールすると、次のようなエラーが表示されます。

```Output
0x80070666 - Another version of this product is already installed. Installation of this version cannot continue. To configure or remove the existing version of this product, use Add/Remove Programs on the Control Panel.
```

このエラーは仕様によるものです。 最新バージョンをインストールしておくことをお勧めします。 インストーラーがこのエラーから自動的に回復できることを確認します。

## <a name="see-also"></a>関連項目

[変更履歴の Visual C++](../porting/visual-cpp-change-history-2003-2015.md)\
[サポートされている最新の Visual C++ 再頒布可能なダウンロード](https://support.microsoft.com/help/2977003/the-latest-supported-visual-c-downloads)
